{% extends 'base.html' %}
{% block content %}
<h1>Дашборд</h1>

<div class="row mb-4">
  <div class="col-md-4">
    <div class="card text-bg-light mb-3">
      <div class="card-body">
        <h5 class="card-title">Доступный баланс</h5>
        <p class="card-text fs-4">${{ '%.2f'|format(available) }}</p>
      </div>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card text-bg-light mb-3">
      <div class="card-body">
        <h5 class="card-title">Расход за 30 дней</h5>
        <p class="card-text fs-4">${{ '%.2f'|format(total_usage) }}</p>
      </div>
    </div>
  </div>
</div>

<h2>Ежедневные расходы</h2>
<table class="table table-sm mb-4">
  <thead>
    <tr><th>Дата</th><th>$</th></tr>
  </thead>
  <tbody>
  {% for d in daily %}
    <tr><td>{{ d.date }}</td><td>{{ '%.2f'|format(d.cost) }}</td></tr>
  {% else %}
    <tr><td colspan="2">Нет данных</td></tr>
  {% endfor %}
  </tbody>
</table>

<h2>Быстрый запрос</h2>
<form action="/generate" method="post" class="mb-3 animate__animated animate__fadeIn">
    <div class="mb-3">
        <label class="form-label">Ассистент</label>
        <select name="assistant_id" class="form-select">
        {% for a in assistants %}
            <option value="{{ a.id }}" {% if a.id == selected_assistant %}selected{% endif %}>{{ a.name or a.id }}</option>
        {% endfor %}
        </select>
    </div>
    <div class="mb-3">
        <label for="prompt" class="form-label">Запрос</label>
        <textarea name="prompt" id="prompt" class="form-control" rows="4">{{ prompt|default('') }}</textarea>
    </div>
    <button type="submit" class="btn btn-primary">Отправить</button>
</form>
{% if answer %}
<h3>Ответ</h3>
<pre class="bg-light p-3">{{ answer }}</pre>
{% endif %}
{% endblock %}
